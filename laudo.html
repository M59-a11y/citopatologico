<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LAUDO — SI</title>

  <style>
    /* =========================================================
       ✅ LAUDO - PADRÃO IMPRESSÃO A4
       - preenchimento automático por URL/localStorage
       - glass/transparência na tela
       - impressão perfeita em branco
    ========================================================= */

    :root{
      --txt:#111827;
      --muted:#374151;
      --border:#cbd5e1;
    }

    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; }

    body{
      font-family: Arial, sans-serif;
      color: var(--txt);
      background: transparent !important; /* ✅ sem branco por trás */
    }

    /* Barra de ações (não imprime) */
    .toolbar{
      position: sticky;
      top:0;
      z-index:10;
      background: rgba(255,255,255,.92);
      border-bottom:1px solid rgba(0,0,0,.08);
      padding: 10px 12px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      align-items:center;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .toolbar strong{
      font-size: 12px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: #0f172a;
      font-weight: 900;
    }

    .btn{
      border:none;
      background:#0ea5e9;
      color:#fff;
      font-weight:900;
      padding: 10px 14px;
      border-radius: 10px;
      cursor:pointer;
      font-size: 12px;
      letter-spacing:.06em;
      text-transform: uppercase;
      box-shadow: 0 10px 18px rgba(0,0,0,.12);
    }
    .btn:active{ transform: translateY(1px); }

    /* Página A4 */
    .page{
      width: 210mm;
      min-height: 297mm;
      padding: 14mm 14mm 18mm 14mm;
      margin: 0 auto;
      position: relative;

      /* ✅ glass na tela */
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.18);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 18px;
    }

    /* Cabeçalho do laudo */
    .header{
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 12px;
      padding: 10px 12px;
      display:flex;
      justify-content:space-between;
      gap: 10px;
      align-items:flex-start;

      background: rgba(255,255,255,.08);
    }

    .headerLeft .title{
      font-weight: 900;
      font-size: 14px;
      letter-spacing:.08em;
      text-transform:uppercase;
      margin:0 0 6px 0;
      color: #fff;
    }

    .headerLeft .sub{
      margin:0;
      font-size: 12px;
      color: rgba(255,255,255,.85);
      font-weight: 800;
    }

    .headerRight{
      text-align:right;
      min-width: 190px;
      font-size: 12px;
    }

    .headerRight .lbl{
      color: rgba(255,255,255,.82);
      font-weight: 800;
      display:block;
      margin-bottom:2px;
      text-transform: uppercase;
      letter-spacing: .08em;
    }

    .headerRight .v{
      font-weight:900;
      color:#fff;
    }

    /* Dados paciente */
    .block{
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(255,255,255,.06);
    }

    .blockTitle{
      margin:0 0 8px 0;
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: #fff;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 10px;
    }

    .line{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      padding: 4px 0;
      border-bottom: 1px dashed rgba(255,255,255,.18);
    }
    .line:last-child{ border-bottom:none; }

    .item{
      display:flex;
      gap:6px;
      align-items:baseline;
      min-width: 220px;
    }

    .k{
      font-size: 11px;
      font-weight: 900;
      letter-spacing:.08em;
      text-transform: uppercase;
      color: rgba(255,255,255,.82);
      white-space:nowrap;
    }

    .v{
      font-size: 12px;
      font-weight: 800;
      color: #ffffff;
      word-break: break-word;
    }

    /* Corpo do laudo */
    .content{
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 12px;
      padding: 12px;
      min-height: 155mm;
      background: rgba(255,255,255,.06);
    }

    .contentTitle{
      margin:0 0 10px 0;
      font-size: 12px;
      font-weight: 900;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: #ffffff;
    }

    .text{
      font-size: 12px;
      line-height: 1.45;
      color: #ffffff;
      white-space: pre-wrap;
      min-height: 120mm;
      font-weight: 700;
    }

    /* Assinatura */
    .assinatura{
      margin-top: 10px;
      border: 1px solid rgba(255,255,255,.18);
      border-radius: 12px;
      padding: 12px;
      display:flex;
      justify-content:space-between;
      align-items:flex-end;
      gap: 10px;
      background: rgba(255,255,255,.06);
    }

    .assinatura .resp{
      font-size: 12px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing:.08em;
      color: #ffffff;
    }

    .assinatura .resp small{
      display:block;
      margin-top: 4px;
      font-size: 11px;
      font-weight: 800;
      color: rgba(255,255,255,.85);
      text-transform:none;
      letter-spacing:0;
    }

    /* Rodapé fixo */
    .footer{
      position: absolute;
      left: 14mm;
      right: 14mm;
      bottom: 10mm;
      border-top: 1px solid rgba(255,255,255,.18);
      padding-top: 6px;
      font-size: 10px;
      color: rgba(255,255,255,.75);
      display:flex;
      justify-content:space-between;
      gap: 10px;
      font-weight: 800;
      letter-spacing:.06em;
    }

    /* Impressão */
    @media print{
      .toolbar{ display:none !important; }

      body{ background:#fff !important; }

      .page{
        margin:0;
        width:auto;
        min-height:auto;

        /* ✅ impressão em branco */
        background:#fff !important;
        border:none !important;
        backdrop-filter:none !important;
        -webkit-backdrop-filter:none !important;
        border-radius: 0 !important;
      }

      .header,.block,.content,.assinatura{
        background:#fff !important;
        border:1px solid var(--border) !important;
      }

      .headerLeft .title,
      .headerLeft .sub,
      .headerRight .lbl,
      .headerRight .v,
      .blockTitle,
      .contentTitle,
      .k,.v,
      .text,
      .assinatura .resp,
      .assinatura .resp small,
      .footer{
        color:#111 !important;
      }

      .line{ border-bottom: 1px dashed rgba(0,0,0,.25) !important; }
      .footer{ border-top: 1px solid rgba(0,0,0,.25) !important; }
    }
  </style>
</head>

<body>

  <div class="toolbar">
    <strong>LAUDO — EMISSÃO</strong>
    <button class="btn" id="btnImprimir" type="button">IMPRIMIR</button>
  </div>

  <div class="page" id="page">

    <div class="header">
      <div class="headerLeft">
        <p class="title">SI — SISTEMA DE INFORMAÇÃO</p>
        <p class="sub">LAUDO / EMISSÃO</p>
      </div>

      <div class="headerRight">
        <span class="lbl">Nº EXAME</span>
        <span class="v" id="exame">—</span>
      </div>
    </div>

    <div class="block">
      <p class="blockTitle">Dados do paciente</p>

      <div class="grid">
        <div>
          <div class="line">
            <div class="item" style="min-width:100%;">
              <span class="k">Paciente:</span>
              <span class="v" id="paciente">—</span>
            </div>
          </div>

          <div class="line">
            <div class="item">
              <span class="k">Data Coleta:</span>
              <span class="v" id="data_coleta">—</span>
            </div>

            <div class="item">
              <span class="k">Nascimento:</span>
              <span class="v" id="data_nascimento">—</span>
            </div>
          </div>

          <div class="line">
            <div class="item">
              <span class="k">Cartão SUS:</span>
              <span class="v" id="cartao_sus">—</span>
            </div>

            <div class="item">
              <span class="k">Telefone:</span>
              <span class="v" id="telefone">—</span>
            </div>
          </div>
        </div>

        <div>
          <div class="line">
            <div class="item" style="min-width:100%;">
              <span class="k">Endereço:</span>
              <span class="v" id="endereco">—</span>
            </div>
          </div>

          <div class="line">
            <div class="item" style="min-width:100%;">
              <span class="k">Cidade / CEP:</span>
              <span class="v" id="cidadeCep">—</span>
            </div>
          </div>

          <div class="line">
            <div class="item" style="min-width:100%;">
              <span class="k">Observação:</span>
              <span class="v" id="observacao">—</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="content">
      <p class="contentTitle">Conteúdo do laudo</p>

      <div class="text" id="textoLaudo">
RESULTADO:

(Preencha aqui os achados do exame.)

OBSERVAÇÕES:

(Se necessário.)
      </div>
    </div>

    <div class="assinatura">
      <div class="resp">
        Responsável técnico:
        <small id="responsavel">—</small>
      </div>

      <div style="text-align:right;font-size:11px;color:rgba(255,255,255,.85);font-weight:900;">
        Emissão: <span id="emissao">—</span>
      </div>
    </div>

    <div class="footer">
      <span>SI — SISTEMA DE INFORMAÇÃO</span>
      <span id="footerExame">EXAME: —</span>
    </div>

  </div>

  <script>
    const $ = (id)=>document.getElementById(id);

    function getParam(nome){
      return new URLSearchParams(window.location.search).get(nome) || "";
    }

    function lerDados(){
      const dados = {
        paciente: getParam("paciente"),
        exame: getParam("exame"),
        data_coleta: getParam("data_coleta"),
        data_nascimento: getParam("data_nascimento"),
        cartao_sus: getParam("cartao_sus"),
        telefone: getParam("telefone"),
        rua: getParam("rua"),
        bairro: getParam("bairro"),
        cidade: getParam("cidade"),
        cep: getParam("cep"),
        responsavel: getParam("responsavel"),
        observacao: getParam("observacao")
      };

      if(!dados.paciente){
        try{
          const ls = JSON.parse(localStorage.getItem("SI_DADOS_LAUDO") || "{}");
          Object.assign(dados, ls);
        }catch(e){}
      }

      return dados;
    }

    function montarEndereco(d){
      const a = [];
      if(d.rua) a.push(d.rua);
      if(d.bairro) a.push(d.bairro);
      return a.length ? a.join(" — ") : "—";
    }

    function montarCidadeCep(d){
      const a = [];
      if(d.cidade) a.push(d.cidade);
      if(d.cep) a.push(d.cep);
      return a.length ? a.join(" — ") : "—";
    }

    function hojeBR(){
      const dt = new Date();
      const dd = String(dt.getDate()).padStart(2,"0");
      const mm = String(dt.getMonth()+1).padStart(2,"0");
      const aa = dt.getFullYear();
      return `${dd}/${mm}/${aa}`;
    }

    function preencher(){
      const d = lerDados();

      $("paciente").textContent = d.paciente || "—";
      $("exame").textContent = d.exame || "—";
      $("data_coleta").textContent = d.data_coleta || "—";
      $("data_nascimento").textContent = d.data_nascimento || "—";
      $("cartao_sus").textContent = d.cartao_sus || "—";
      $("telefone").textContent = d.telefone || "—";
      $("observacao").textContent = d.observacao || "—";
      $("responsavel").textContent = d.responsavel || "—";
      $("endereco").textContent = montarEndereco(d);
      $("cidadeCep").textContent = montarCidadeCep(d);
      $("emissao").textContent = hojeBR();
      $("footerExame").textContent = `EXAME: ${d.exame || "—"}`;
    }

    function avisarIndexImpressao(){
      try{
        window.parent.postMessage({ type: "LAUDO_IMPRESSO" }, "*");
      }catch(e){}
    }

    window.addEventListener("load", preencher);

    $("btnImprimir").addEventListener("click", ()=> window.print());
    window.addEventListener("afterprint", avisarIndexImpressao);
  </script>

</body>
</html>
