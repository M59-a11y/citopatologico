<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SI - SISTEMA DE INFORMAÇÃO . LAUDOS.</title>

  <link rel="icon" href="img/favicon/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="img/favicon/favicon-32x32.png">

  <style>
    :root{
      --stroke: rgba(255,255,255,.20);
      --shadow: 0 18px 55px rgba(0,0,0,.22);
      --shadow2: 0 10px 22px rgba(0,0,0,.16);
    }

    *{ box-sizing:border-box; }

    html, body{
      width:100%;
      height:100%;
      margin:0;
      padding:0;
      overflow:hidden;
    }

    body{
      font-family: Arial, sans-serif;
      color:#fff;
      background: linear-gradient(135deg, #69ff9f 0%, #2be28d 18%, #0e4d7d 65%, #06233f 100%);
      position: relative;
    }

    /* ✅ Logo grande ao fundo */
    body::before{
      content:"";
      position:absolute;
      inset:0;
      background: url("logo/logotipo.png") center 55% / 760px no-repeat;
      opacity: 0.22;
      pointer-events:none;
      z-index:0;
      filter: contrast(1.25) brightness(1.08);
    }

    /* ✅ Degradê por cima (paninho) */
    body::after{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(circle at 15% 20%, rgba(255,255,255,.14), transparent 44%),
        radial-gradient(circle at 85% 75%, rgba(115,255,154,.09), transparent 44%),
        linear-gradient(180deg, rgba(0,0,0,.28), rgba(0,0,0,.30));
      pointer-events:none;
      z-index:0;
    }

    .app{
      position:relative;
      z-index:1;
      width:100%;
      height:100%;
      display:grid;
      grid-template-columns: 47% 53%;
      gap: 14px;
      padding: 14px 18px;
      align-items:stretch;
    }

    .left{
      height:100%;
      display:flex;
      flex-direction:column;
      gap: 12px;
      overflow:hidden;
    }

    header{
      height:74px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding: 0 2px;
    }

    .sysOnly{
      margin:0;
      display:flex;
      align-items:center;
      gap:10px;
      white-space:nowrap;
      font-weight:900;
      letter-spacing:.9px;
      text-transform:uppercase;
      text-shadow: 0 12px 28px rgba(0,0,0,.32);
    }
    .sysOnly .t1{ font-size: 18px; }
    .sysOnly .dot{ font-size: 14px; opacity:.82; transform: translateY(-1px); }
    .sysOnly .t2{
      font-size: 18px;
      padding: 3px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.14);
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 10px 20px rgba(0,0,0,.14);
    }

    .devCard{
      padding: 10px 14px;
      border-radius: 14px;
      background: rgba(6, 35, 63, 0.88);
      border: 1px solid rgba(255,255,255,.18);
      box-shadow: 0 10px 20px rgba(0,0,0,.18);
      text-align:right;
      user-select:none;
      min-width: 170px;
    }
    .devCard .nome{
      font-size: 12px;
      font-weight: 900;
      letter-spacing: .8px;
      text-transform:uppercase;
      margin-bottom:2px;
    }
    .devCard .cargo{
      font-size: 10px;
      font-weight: 800;
      letter-spacing: .8px;
      color: rgba(255,255,255,.78);
      text-transform:uppercase;
    }

    main{
      flex:1 1 auto;
      min-height:0;
      display:flex;
      overflow:hidden;
    }

    .glass{
      width: 100%;
      height: 100%;
      border-radius: 26px;
      border: 1px solid var(--stroke);
      background: linear-gradient(180deg, rgba(255,255,255,.13), rgba(255,255,255,.06));
      box-shadow: var(--shadow);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      overflow:hidden;
      display:flex;
    }

    .panel{
      width:100%;
      height:100%;
      min-height:0;
      padding: 14px 16px;
      display:flex;
      flex-direction:column;
      gap: 12px;
      overflow-y:auto;
      overflow-x:hidden;
    }

    .panelTitle{
      margin:0;
      font-size: 22px;
      font-weight: 900;
      letter-spacing: 1px;
      text-transform: uppercase;
      text-shadow: 0 10px 24px rgba(0,0,0,.30);
      line-height:1.05;
    }

    /* ✅ Guia discreto */
    .legend{
      margin: -2px 0 6px 0;
      padding: 10px 12px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.09);
      box-shadow: var(--shadow2);
      font-size: 12px;
      font-weight: 900;
      letter-spacing: .6px;
      color: rgba(255,255,255,.92);
      line-height: 1.25;
    }
    .legend small{
      display:block;
      margin-top:6px;
      font-size: 11px;
      font-weight: 800;
      color: rgba(255,255,255,.78);
      letter-spacing: .4px;
    }

    /* ✅ formulário */
    .form{
      display:flex;
      flex-direction:column;
      gap: 10px;
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }

    .campo label{
      display:block;
      font-size: 12px;
      font-weight: 900;
      letter-spacing: .4px;
      margin: 0 0 6px 2px;
      color: rgba(255,255,255,.92);
      text-transform: uppercase;
    }

    .campo input, .campo select, .campo textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.16);
      box-shadow: 0 10px 18px rgba(0,0,0,.14);
      padding: 12px 12px;
      outline:none;
      font-size: 14px;
      color:#fff;
      line-height: 1.2;
    }

    .campo textarea{
      min-height: 80px;
      resize:none;
      overflow:auto;
    }

    .campo input::placeholder{ color: rgba(255,255,255,.58); }
    .campo textarea::placeholder{ color: rgba(255,255,255,.58); }

    /* ✅ feedback validação */
    .ok{
      border-color: rgba(0,255,140,.65) !important;
      box-shadow: 0 0 0 4px rgba(0,255,140,.12) !important;
    }
    .erro{
      border-color: rgba(255,70,70,.65) !important;
      box-shadow: 0 0 0 4px rgba(255,70,70,.10) !important;
    }

    .btn{
      width: 100%;
      border:none;
      border-radius: 18px;
      padding: 12px 16px;
      cursor:pointer;
      font-size: 16px;
      font-weight: 900;
      color:#041b2f;
      background: linear-gradient(90deg, #00e09c, #1376b8);
      box-shadow: 0 16px 26px rgba(0,0,0,.18);
      transition: transform .08s ease, filter .2s ease;
      margin-top: 4px;
    }
    .btn:hover{ filter: brightness(1.03); }
    .btn:active{ transform: translateY(1px); }

    .right{
      height:100%;
      border-radius: 26px;
      border: 1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(255,255,255,.11), rgba(255,255,255,.05));
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }

    .rightTop{
      height:46px;
      padding: 10px 14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      border-bottom:1px solid rgba(255,255,255,.12);
      background: rgba(6,35,63,.45);
    }
    .rightTop strong{
      font-size:12px;
      letter-spacing:.12em;
      text-transform:uppercase;
      font-weight:900;
    }

    .frameWrap{
      flex:1 1 auto;
      min-height:0;
      background: rgba(0,0,0,.10);
      padding: 10px;
      overflow:hidden;
    }

    #iframeLaudo{
      width:100%;
      height:100%;
      border:0;
      display:block;
      background:#fff;
      border-radius: 18px;
      box-shadow: 0 16px 30px rgba(0,0,0,.18);
    }

    /* ✅ Responsivo */
    @media (max-width: 1180px){
      html,body{ overflow:auto; }
      .app{ grid-template-columns: 1fr; height:auto; }
      .right{ height: 62vh; }
      main{ height: calc(100vh - 120px); }
    }
  </style>
</head>

<body>
  <div class="app">

    <div class="left">
      <header>
        <h1 class="sysOnly">
          <span class="t1">SI — SISTEMA DE INFORMAÇÃO</span>
          <span class="dot" aria-hidden="true">●</span>
          <span class="t2">LAUDOS</span>
        </h1>

        <div class="devCard">
          <div class="nome">MARCOS PONTES</div>
          <div class="cargo">DESENVOLVEDOR</div>
        </div>
      </header>

      <main>
        <section class="glass">
          <div class="panel">
            <h2 class="panelTitle">Digitação rápida</h2>

            <div class="legend">
              Preencha campo por campo e use <b>TAB</b> para avançar.
              Datas e números formatam automaticamente enquanto você digita.
              <small>Atalho: <b>Ctrl + Enter</b> abre o laudo.</small>
            </div>

            <div class="form" id="formRapido">
              <div class="campo">
                <label for="paciente">Paciente</label>
                <input id="paciente" type="text" placeholder="Nome completo do paciente" autocomplete="off">
              </div>

              <div class="row2">
                <div class="campo">
                  <label for="exame">Nº Exame</label>
                  <input id="exame" type="text" placeholder="000000/0000" autocomplete="off">
                </div>
                <div class="campo">
                  <label for="responsavel">Responsável</label>
                  <select id="responsavel">
                    <option value="">Selecione...</option>
                    <option value="SNM">SNM — SHEINA N. MORAIS RAMALHO</option>
                    <option value="EAM">EAM — EDVÂNIA APARECIDA MENDES DE AZEVÊDO</option>
                    <option value="RHN">RHN — ROSA HELENA NOGUEIRA GUIMARÃES VERAS</option>
                  </select>
                </div>
              </div>

              <div class="row2">
                <div class="campo">
                  <label for="data_coleta">Data da Coleta</label>
                  <input id="data_coleta" type="text" placeholder="DD/MM/AAAA" autocomplete="off">
                </div>
                <div class="campo">
                  <label for="data_nascimento">Data Nascimento</label>
                  <input id="data_nascimento" type="text" placeholder="DD/MM/AAAA" autocomplete="off">
                </div>
              </div>

              <div class="row2">
                <div class="campo">
                  <label for="sus">Cartão SUS (11 ou 15 dígitos)</label>
                  <input id="sus" type="text" placeholder="Somente números" autocomplete="off" inputmode="numeric">
                </div>
                <div class="campo">
                  <label for="telefone">Telefone</label>
                  <input id="telefone" type="text" placeholder="(99) 99999-9999" autocomplete="off" inputmode="numeric">
                </div>
              </div>

              <div class="campo">
                <label for="rua">Rua</label>
                <input id="rua" type="text" placeholder="Rua / Av. / Travessa" autocomplete="off">
              </div>

              <div class="row2">
                <div class="campo">
                  <label for="bairro">Bairro</label>
                  <input id="bairro" type="text" placeholder="Bairro" autocomplete="off">
                </div>
                <div class="campo">
                  <label for="cidade">Cidade</label>
                  <input id="cidade" type="text" placeholder="Cidade" autocomplete="off">
                </div>
              </div>

              <div class="row2">
                <div class="campo">
                  <label for="cep">CEP</label>
                  <input id="cep" type="text" placeholder="00000-000" autocomplete="off" inputmode="numeric">
                </div>
                <div class="campo">
                  <label for="observacao">Observação</label>
                  <input id="observacao" type="text" placeholder="Observação extra (se houver)" autocomplete="off">
                </div>
              </div>

              <button class="btn" id="btnExtrair" type="button">ABRIR LAUDO NO PAINEL</button>
            </div>
          </div>
        </section>
      </main>
    </div>

    <aside class="right">
      <div class="rightTop">
        <strong>LAUDO — EMISSÃO</strong>
      </div>
      <div class="frameWrap">
        <iframe id="iframeLaudo" title="Laudo"></iframe>
      </div>
    </aside>

  </div>

  <script>
    const LAUDO_URL = "laudo.html";
    const $ = (id)=>document.getElementById(id);

    const MAPA_RESP = {
      EAM: "EDVÂNIA APARECIDA MENDES DE AZEVÊDO",
      SNM: "SHEINA N. MORAIS RAMALHO",
      RHN: "ROSA HELENA NOGUEIRA GUIMARÃES VERAS"
    };

    const soDigitos = (s)=> (s || "").replace(/\D+/g, "");

    function aplicarMascaraData(el){
      el.addEventListener("input", ()=>{
        let v = soDigitos(el.value).slice(0,8);
        if(v.length > 2) v = v.slice(0,2) + "/" + v.slice(2);
        if(v.length > 5) v = v.slice(0,5) + "/" + v.slice(5);
        el.value = v;
        el.classList.toggle("ok", v.length === 10);
        el.classList.toggle("erro", v.length > 0 && v.length !== 10);
      });
    }

    function aplicarMascaraCEP(el){
      el.addEventListener("input", ()=>{
        let v = soDigitos(el.value).slice(0,8);
        if(v.length > 5) v = v.slice(0,5) + "-" + v.slice(5);
        el.value = v;
        el.classList.toggle("ok", v.length === 9);
        el.classList.toggle("erro", v.length > 0 && v.length !== 9);
      });
    }

    function aplicarMascaraTelefone(el){
      el.addEventListener("input", ()=>{
        let v = soDigitos(el.value).slice(0,11);
        if(v.length <= 10){
          // (99) 9999-9999
          if(v.length > 2) v = "(" + v.slice(0,2) + ") " + v.slice(2);
          if(v.length > 9) v = v.slice(0,9) + "-" + v.slice(9);
        }else{
          // (99) 99999-9999
          v = "(" + v.slice(0,2) + ") " + v.slice(2,7) + "-" + v.slice(7);
        }
        el.value = v;
        const dig = soDigitos(v);
        el.classList.toggle("ok", dig.length === 10 || dig.length === 11);
        el.classList.toggle("erro", dig.length > 0 && dig.length < 10);
      });
    }

    function aplicarMascaraExame(el){
      el.addEventListener("input", ()=>{
        let v = soDigitos(el.value).slice(0,10); // 6 + 4
        if(v.length > 6) v = v.slice(0,6) + "/" + v.slice(6);
        el.value = v;
        el.classList.toggle("ok", v.length >= 8);  // tolerante
        el.classList.toggle("erro", v.length > 0 && v.length < 7);
      });
    }

    function aplicarRegraSUS(el){
      el.addEventListener("input", ()=>{
        const d = soDigitos(el.value).slice(0,15);
        el.value = d; // ✅ sempre número corrido
        const ok = (d.length === 11 || d.length === 15);
        el.classList.toggle("ok", ok);
        el.classList.toggle("erro", !ok && d.length > 0);
      });
    }

    function coletarDados(){
      const sigla = $("responsavel").value.trim().toUpperCase();
      const responsavel = sigla ? (MAPA_RESP[sigla] || sigla) : "";

      return {
        paciente: $("paciente").value.trim(),
        exame: $("exame").value.trim(),
        data_coleta: $("data_coleta").value.trim(),
        data_nascimento: $("data_nascimento").value.trim(),
        cartao_sus: $("sus").value.trim(),      // ✅ já está corrido
        telefone: soDigitos($("telefone").value),
        rua: $("rua").value.trim(),
        bairro: $("bairro").value.trim(),
        cidade: $("cidade").value.trim(),
        cep: $("cep").value.trim(),
        responsavel,
        observacao: $("observacao").value.trim()
      };
    }

    function abrirLaudoNoPainel(dados){
      localStorage.setItem("SI_DADOS_LAUDO", JSON.stringify({ ...dados, ts: Date.now() }));

      const params = new URLSearchParams();
      Object.entries(dados).forEach(([k,v])=>{
        if(v) params.set(k, v);
      });

      params.set("v", Date.now());
      $("iframeLaudo").src = `${LAUDO_URL}?${params.toString()}`;
    }

    // ✅ aplica máscaras
    aplicarMascaraExame($("exame"));
    aplicarMascaraData($("data_coleta"));
    aplicarMascaraData($("data_nascimento"));
    aplicarRegraSUS($("sus"));
    aplicarMascaraTelefone($("telefone"));
    aplicarMascaraCEP($("cep"));

    // ✅ botão abrir laudo
    $("btnExtrair").addEventListener("click", ()=>{
      const dados = coletarDados();
      if(!dados.paciente){
        alert("Digite o nome do paciente.");
        $("paciente").focus();
        return;
      }
      abrirLaudoNoPainel(dados);
    });

    // ✅ Ctrl + Enter
    document.addEventListener("keydown", (e)=>{
      if(e.ctrlKey && e.key === "Enter"){
        e.preventDefault();
        $("btnExtrair").click();
      }
    });

    // ✅ limpa campos quando imprimir
    window.addEventListener("message", (ev)=>{
      if(ev.data && ev.data.type === "LAUDO_IMPRESSO"){
        document.querySelectorAll("#formRapido input, #formRapido select").forEach(el=>{
          if(el.tagName === "SELECT") el.value = "";
          else el.value = "";
          el.classList.remove("ok","erro");
        });
        $("paciente").focus();
      }
    });

    // foco inicial
    window.addEventListener("load", ()=> $("paciente").focus());
  </script>
</body>
</html>
